<!DOCTYPE html>
<!-- for the time being I want to keep both the css and js embedded -->
<head>
<title>Cost Calculator - Work out your monthly living costs</title>
<style type="text/css">
#wrapper {margin: 0 auto;width:500px;position: relative;}
input[type='text'] {margin: 5px 0;}
label {margin-right: 5px;}
table {margin-top: 60px;}
th, td {min-width: 150px;}
td {text-align: center;}
#help {position: absolute; top: 10px; left: 350px; width: 350px;}
li {list-style: none;}
.add {position:relative;left: 250px;top: -60px;}
#frequency-buttons {margin-top: 10px;}
.toggle-help {cursor: pointer;margin:0;color:#666;}
.toggle-help:hover {color: #000;}
.show-help {display: none; }
</style>
</head>
<body>
<div id="wrapper">
<h1>Cost Calculator</h1>
<div id="help">
<p class="toggle-help" title="click to show help"><span>Show</span> Help?</p>
<div class="show-help">
<p>Add an item, add a cost, choose the frequency and see the totals at the bottom.</p>
<p>When there are no cost items the headings are hidden.</p>
<ul>
<li>-- TO DO LIST --</li>
<li>Possibly add a quarterly total and quarterly radio button</li>
<li>Change delete button to a cross icon</li>
<li>Use local storage to save data</li>
<li>Change confirm and alert for jquery modal dialog</li>
</ul>
</div><!-- end .show-help -->
</div><!-- end #help -->
<form>
<label for="add-item">Item</label>
<input type="text" id="add-item" name="add-item" value="" /><br />
<label for="add-cost">Cost</label>
<input type="text" id="add-cost" name="add-cost" value="" /><br />
<div id="frequency-buttons">
<input type="radio" name="frequency" value="weekly" />Weekly
<input type="radio" name="frequency" value="monthly" checked />Monthly
<input type="radio" name="frequency" value="yearly" />Yearly<br />
</div>
<button class="add">Add Item</button>
</form>
<table id="cost-list">
<thead>
<th>No.</th><th>Item</th><th>Cost</th><th>Frequency</th>
</thead>
<tbody>
<!-- the table rows will be added dynamically here -->
</tbody>
</table>
<table id="totals">
<tbody>
<tr id="weekly"><td>Total Weekly Costs</td><td></td></tr>
<tr id="monthly"><td>Total Monthly Costs</td><td></td></tr>
<tr id="yearly"><td>Total Yearly Costs</td><td></td></tr>
</tbody>
</table>
</div> <!-- end #wrapper -->
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script> 
<script type="text/javascript">
$(document).ready(function(){
var newItem = ""; 
var newCost = "";
var frequency = "monthly";
var $addItem = $('#add-item');
var $addCost = $('#add-cost');
var $frequency = $('input[type="radio"]:checked');
var yearlyTotal = 0;
var multiplier = 12;
var rowYearlyTotal = 0;
// function to update the yearly totals
function updateTotals(yearlyTotal) {
	$('#yearly').find('td').last().html("&pound; " + yearlyTotal.toFixed(2));
	$('#monthly').find('td').last().html("&pound; " + (yearlyTotal/12.0).toFixed(2));
	$('#weekly').find('td').last().html("&pound; " + (yearlyTotal/52.0).toFixed(2));
}
// set totals to zero
updateTotals(yearlyTotal);

// update the value for newItem
$addItem.keyup(function(){
	newItem = $(this).val();
});
// update the value for newCost
$addCost.keyup(function(){
	newCost = $(this).val();
});
// cache the value for monthly, weekly or yearly
$('input[type="radio"]').on('click', function(){
	frequency = $(this).val();
	if (frequency === 'weekly') {
		multiplier = 52;
	} else if (frequency === 'monthly') {
		multiplier = 12;
	} else {
		multiplier = 1;
	}
});
// give focus to first input - add item
function focusItem() {
	$addItem.focus();
}
// update the row numbering 
function updateRowNum() {
	var $costRow = $('#cost-list').find('tbody tr');
	var rowCount = $costRow.length;
	var firstRow = $costRow.first();
	firstRow.find('td').first().text(1);
		for (var i = 1; i < rowCount; i++) {
		firstRow.next().find('td').first().text(i+1);
		firstRow = firstRow.next();
		}
}
// start by hiding the tables
$('table').hide();

// focus the first input
focusItem();

// add a new row when the 'add item' button is clicked
// adding a new row should update totals
$('button').on('click', function() {
	// calculate the yearly total for the new row
	// save the value in data-rowtotal attribute
	rowYearlyTotal = parseFloat(newCost) * multiplier;
	var newRow = "<tr data-rowtotal='" + rowYearlyTotal + 
			"'><td>" + "&nbsp;" + 
			"</td><td>" + newItem + 
			"</td><td>&pound;" + parseFloat(newCost).toFixed(2) + 
			"</td><td>" + frequency + 
			"</td><td><button class='delete'>delete</button></td></tr>";
	// some error checking before appending the row
	// if the either or both fields are empty
	if (newCost === '' || newItem === '') {
		alert('You need to fill in both the Cost and Item fields');
		focusItem();
		return false;
	// if cost is not a number or a decimal
	} else if(newCost != newCost.match(/^[0-9]+\.?[0-9]*$/)){
		alert('Cost needs to be a number');
		$addCost.focus().select();
		return false;
	} else {
	$('table').show();
	$('tbody').closest('#cost-list').append(newRow);

	// add the amount to the yearly total
	yearlyTotal += rowYearlyTotal;
	updateTotals(yearlyTotal);
	// update the row numbering
	updateRowNum();
	// clear the input fields to prevent add-item button 
	// working to repeatedly adding the same item
	var empty = '';
	$addCost.val(empty);
	$addItem.val(empty);
	newCost = empty;
	newItem = empty;
	focusItem();
	return false;
	}
});
// pop a confirm dialogue when delete is clicked
// clicking OK removes the row and updates the totals
$('#cost-list').on('click', '.delete', function() {
if (confirm('Are you sure?')){
	var $closestRow = $(this).closest('tr');
	yearlyTotal -= $closestRow.data('rowtotal');
	$closestRow.remove();
	updateTotals(yearlyTotal);
	updateRowNum();
	focusItem();
	if ($('#cost-list').find('tr').length === 1) {
		$('table').hide();
		}
	} else {
	focusItem();
	}
});
// toggle the help button
$('.toggle-help').on('click', function () {
	$('.show-help').slideToggle(600);
	var $toggleHelp = $('.toggle-help');
	var $showHide = $toggleHelp.find('span').text();
	focusItem();
	if ($showHide === 'Show') {
		$toggleHelp.find('span').text('Hide');
		$toggleHelp.attr('title','Click to hide help');
	} else if ($showHide === 'Hide') {
		$toggleHelp.find('span').text('Show');
		$toggleHelp.attr('title','Click to show help');
	}
});
});// end ready
if (localStorage) {
	console.log("There is local storage");
}
</script>
</body>
</html>
